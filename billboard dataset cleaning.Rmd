---
title: "billboard_data_wrangling"
author: "Ling"
date: "11/16/2021"
output: github_document
---

- The cleaned dataset

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(rvest)
library(httr)
library(kaggler)
library(haven)

kgl_auth(creds_file = 'kaggle.json')

response <- kgl_datasets_download_all(owner_dataset = "danield2255/data-on-songs-from-billboard-19992019")

download.file(response[["url"]], "data/temp.zip", mode = "wb")
unzip_result <- unzip("data/temp.zip", exdir = "./data", overwrite = TRUE)

billboard = read_csv("./data/BillboardFromLast20/billboardHot100_1999-2019.csv") %>%
  janitor::clean_names() %>%
  select(-c("date","features","weekly_rank","writing_credits")) %>%
  mutate(year = format(week, "%Y"),
         lyrics = str_to_lower(str_replace(lyrics, "\n"," ")),
         genre = str_split(str_to_lower(genre), ','))

word_bank_genre_raw = pull(billboard, genre) %>%
  unlist() %>%
  unique() %>%
  as_tibble()

write.csv(word_bank_genre_raw, file = "./data/word_bank_genre_raw_ling.csv")

word_bank_raw = read_html("https://www.addictioncenter.com/drugs/drug-street-names/") %>%
  html_table(header = T)

word_bank_alcohol = read_html("https://www.addictioncenter.com/drugs/drug-alcohol-slang/") %>%
  html_table(header = F) %>%
  nth(2) %>%
  janitor::clean_names() %>%
  select(x2) %>%
  mutate(x2 = str_split(str_to_lower(x2), ',')) %>%
  unlist() %>%
  as_tibble()

write.csv(word_bank_alcohol, file = "./data/alcohol_bank_raw_ling.csv")

drug_bank <- function(raw , var) {
out = raw %>%
janitor::clean_names() %>%
select({{var}}) %>%
mutate(slang = str_split(str_to_lower({{var}}), ',')) %>%
select(slang) %>%
unlist() %>%
as_tibble()
return(out)
}

illicit_names = word_bank_raw[[3]] %>%
  janitor::clean_names()

word_bank_bdz = drug_bank(word_bank_raw[[1]], var = street_names)
word_bank_hallucinogens = drug_bank(word_bank_raw[[2]], var = street_names)
word_bank_inhalant = drug_bank(word_bank_raw[[4]], var = street_names)
word_bank_opioid = drug_bank(word_bank_raw[[5]], var = street_names)
word_bank_overcounter = drug_bank(word_bank_raw[[6]], var = street_names)
word_bank_marijuana = drug_bank(subset(illicit_names, common_name %in% c("Marijuana", "Synthetic Marijuana")), var = other_names)
word_bank_illicit = drug_bank(subset(illicit_names, !(common_name %in% c("Marijuana", "Synthetic Marijuana"))), var = other_names)
word_bank_other = bind_rows(word_bank_bdz, word_bank_hallucinogens, word_bank_illicit, word_bank_inhalant, word_bank_opioid, word_bank_overcounter)
View(word_bank_other)
write_csv(word_bank_other, file = "./data/other_illicit_bank_raw_ling.csv")
write_csv(word_bank_marijuana, file = "./data/marijuana_bank_raw_ling.csv")
```

